<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="styles.css">
    <script src="auth.js" defer></script>
    <link rel="icon" href="images/icone.jpeg" type="image/jpeg">
</head>
<body>
    <header>
        <h1>Cupcake Shop</h1>
        <div class="cart">
            <img src="images/cart.png" alt="Cesto de Compras" class="cart-icon">
            <a href="cart.html">Meu Carrinho</a>
        </div>
    </header>

    <nav class="top-menu">
        <ul>
            <li><a href="index.html">Home |</a></li>
            <li><a href="products.html">Produtos |</a></li>
            <li><a href="#" id="login-link">Login<br></a></li>
        </ul>
    </nav>

    <main>
        <h2>Cadastro</h2>
        <form id="register-form">
            <div>
                <label for="name">Nome:</label>
                <input type="text" id="name" name="name" required>
                <label for="surname">Sobrenome:</label>
                <input type="text" id="surname" name="surname" required style="width: 200%;">
            </div>
            <div>
                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" name="cpf" required pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" title="Digite um CPF no formato XXX.XXX.XXX-XX">
            </div>
            <div>
                <label for="phone">Telefone:</label>
                <input type="text" id="phone" name="phone" required pattern="\(\d{2}\) \d{4}-\d{4}" title="Digite um telefone no formato (XX) XXXX-XXXX">
                <label for="cell">Celular:</label>
                <input type="text" id="cell" name="cell" required pattern="\(\d{2}\) \d{4}-\d{4}" title="Digite um celular no formato (XX) XXXX-XXXX">
            </div>
            <div>
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" required style="width: 125%;">
            </div>
            <div>
                <label for="address">Endereço:</label>
                <input type="text" id="address" name="address" required>
                <label for="number">Número:</label>
                <input type="text" id="number" name="number" required>
            </div>
            <div>
                <label for="complement">Complemento:</label>
                <input type="text" id="complement" name="complement">
                <label for="cep">CEP:</label>
                <input type="text" id="cep" name="cep" required pattern="\d{5}-\d{3}" title="Digite um CEP no formato XXXXX-XXX">
            </div>
            <div>
                <label for="district">Bairro:</label>
                <input type="text" id="district" name="district" required>
            </div>
            <div>
                <label for="state">Estado:</label>
                <select id="state" name="state" required>
                    <!-- Adicione todos os estados brasileiros aqui -->
                    <option value="AC">Acre</option>
                    <option value="AL">Alagoas</option>
                    <option value="AP">Amapá</option>
                    <option value="AM">Amazonas</option>
                    <option value="BA">Bahia</option>
                    <option value="CE">Ceará</option>
                    <option value="DF">Distrito Federal</option>
                    <option value="ES">Espírito Santo</option>
                    <option value="GO">Goiás</option>
                    <option value="MA">Maranhão</option>
                    <option value="MT">Mato Grosso</option>
                    <option value="MS">Mato Grosso do Sul</option>
                    <option value="MG">Minas Gerais</option>
                    <option value="PA">Pará</option>
                    <option value="PB">Paraíba</option>
                    <option value="PR">Paraná</option>
                    <option value="PE">Pernambuco</option>
                    <option value="PI">Piauí</option>
                    <option value="RJ">Rio de Janeiro</option>
                    <option value="RN">Rio Grande do Norte</option>
                    <option value="RS">Rio Grande do Sul</option>
                    <option value="RO">Rondônia</option>
                    <option value="RR">Roraima</option>
                    <option value="SC">Santa Catarina</option>
                    <option value="SP">São Paulo</option>
                    <option value="SE">Sergipe</option>
                    <option value="TO">Tocantins</option>
                </select>
            </div>
            <div>
                <label for="city">Cidade:</label>
                <select id="city" name="city" required>
                    <!-- As cidades serão preenchidas dinamicamente com JavaScript -->
                </select>
            </div>
            <div>
                <label for="password">Senha:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div>
                <label for="confirm-password">Confirme a Senha:</label>
                <input type="password" id="confirm-password" name="confirm-password" required>
                <span id="password-match-error" style="display: none; color: red;">Senha não correspondente</span>
            </div>
            <button type="submit">Cadastrar</button>
        </form>
    </main>

    <script>
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            if (password !== confirmPassword) {
                document.getElementById('password-match-error').style.display = 'block';
                return;
            }
            document.getElementById('password-match-error').style.display = 'none';
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                if (result === "User registered successfully.") {
                    window.location.href = 'login.html';
                }
            })
            .catch(error => console.error('Error:', error));
        });

        document.getElementById('state').addEventListener('change', function() {
            const state = this.value;
            const citySelect = document.getElementById('city');
            citySelect.innerHTML = '';
            // Adicione aqui a lógica para preencher as cidades dinamicamente com base no estado selecionado
        });
    </script>
</body>
</html>
